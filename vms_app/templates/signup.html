<html>
    <head>
        <title>Appointment Signup Page</title>
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
        <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@200;400;500;600;900&display=swap" rel="stylesheet">    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/js/jquery.nice-select.js" integrity="sha512-GkPcugMfi6qlxrYTRUH4EwK4aFTB35tnKLhUXGLBc3x4jcch2bcS7NHb9IxyM0HYykF6rJpGaIJh8yifTe1Ctw==" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/css/nice-select.css" integrity="sha512-uHuCigcmv3ByTqBQQEwngXWk7E/NaPYP+CFglpkXPnRQbSubJmEENgh+itRDYbWV0fUZmUz7fD/+JDdeQFD5+A==" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretty-checkbox@3.0/dist/pretty-checkbox.min.css"/>
        
        {% load static %}
        <link rel="stylesheet" href="{% static 'main.css' %}" />
    
    </head>

    <body>
            <!-- Top Loading Bars -->
            <div id="defaultprog"></div>
            <div id="progress"></div>

            <!-- Main Form -->
            <div id="pageBox">
                <form method="POST" id="pageForm">
                {% csrf_token %}
                    
                 
                 </form>
           
            </div>

              
            <div id="navigation">
                <button id="back" class="navBtn navLeft">
                Back
                </button>
                <button id="cont" class="navBtn navRight">
                Next »
                </button>
            </div>

    </body>

    <script>

        
        let TOTAL_PAGES;
        var page = 0;
        function pageRender(){
            for (let element of document.getElementsByClassName("formSection")){
                if (element.id.includes(page)) { 
                    element.style.display = `inline-block`;
                } else {
                    element.style.display = `none`;
                }

                console.log(page);
                console.log(TOTAL_PAGES);

                if (page === TOTAL_PAGES-1){
                    document.getElementById("cont").innerText = "Submit";
                } else {
                    document.getElementById("cont").innerText = "Next »";
                }

                if (page === 0) {
                    document.getElementById("back").style.cursor = "not-allowed";
                    document.getElementById("back").style.opacity = 0.2;
                } else {
                    document.getElementById("back").style.cursor = "pointer";
                    // document.getElementById("back").style.opacity = 1;
                    // document.getElementById("back").style.color = "white";
                }
            }
        }

        /* Multi page system */
        $('#cont').click( () => {
            
            if (page === TOTAL_PAGES-1){
                // window.location.href = "/vms/preregister";
                document.getElementById("pageForm").submit();
            } else {
                page++;
                pageRender();
            }

        })

        $('#back').click(() => {
            if (page === 0){
                return;
            } else {
                page--;
                pageRender();
            }

        });



        /* Load questions from database */
        var QUESTIONS_ENDPOINT = `/static/questions.json`;
        // fetch(QUESTIONS_ENDPOINT).then(response => response.json()).then(questionData => {
        let questionData = {{ questionData | safe }}
            TOTAL_PAGES = questionData.pages.length;
            var i = 0;
            for (let page of questionData.pages){

                // Create container
                var currContainer = document.createElement("div");
                // Assign ID & set default styling
                currContainer.id = `content-holder-${i}`;
                currContainer.className = `formSection`;
                if (i !== 0 ) currContainer.style.display = `none`;
                // Append to DOM
                document.getElementById("pageForm").appendChild(currContainer);

                for (let question of page.questions){
                    if (question.type === `text`){
                        currContainer.innerHTML += `
                        <h1 class="prompt pl">${question.prompt}</h1>
                        <div class="formRow">
                            <input maxlength="${question.maxLength}" class="textInput" type="text" id="${question.id}" name="${question.id}"/>
                        </div>`;
                    } else if (question.type === `select`) {
                        currContainer.innerHTML += `     
                        <h1 class="prompt pl">${question.prompt}</h1>
                        <div class="formRow">
                            <select name=${question.id} class="selectInput">
                                <option value="select" data-display="Select">Select</option>
                                ${question.options.map(opt=>`<option value="${opt}">${opt}</option>`).join(`\n`)}
                              </select>
                        </div>`;
                        $('select').niceSelect();
                    } else if (question.type === `radio`) {
                        currContainer.innerHTML += `
                        <h1 class="prompt pl">${question.prompt}</h1>
                        ${question.options.map(opt =>`<div class="sltem pretty p-default p-pulse p-round">
                        <input type="radio" name="${question.id}" value="${opt}">
                        <div class="state p-primary"> 
                           <label class="lbf" for="huey">${opt}</label>
                        </div>
                          </div>`).join(`\n`)}
                        `;
                    } else if (question.util === `divider`) {
                        currContainer.innerHTML += `
                        <div style="background-color: rgba(45, 122, 247, 0.3); margin-top: 50px; margin-bottom: -10px; width: 85%; height: 2px;"></div>
                        `;
                    } else if (question.type === `agree`) {
                        currContainer.innerHTML += `<div class="termbox"> 
                        <div class="pl pretty p-svg p-curve">
                            <input type="checkbox" />
                            <div class="state p-success">
                                <svg class="svg svg-icon" viewBox="0 0 20 20">
                                    <path d="M7.629,14.566c0.125,0.125,0.291,0.188,0.456,0.188c0.164,0,0.329-0.062,0.456-0.188l8.219-8.221c0.252-0.252,0.252-0.659,0-0.911c-0.252-0.252-0.659-0.252-0.911,0l-7.764,7.763L4.152,9.267c-0.252-0.251-0.66-0.251-0.911,0c-0.252,0.252-0.252,0.66,0,0.911L7.629,14.566z" style="stroke: white;fill:white;"></path>
                                </svg>
                                <label style="color: white;">.</label>
                            </div>
                        </div>
                        <p class="termlabel">${question.prompt}</p>
                        </div>`;
                    }
                }
                
                i++;
            }

            pageRender();
        // })


    </script>

</html>